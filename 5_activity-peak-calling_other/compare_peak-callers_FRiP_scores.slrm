#!/bin/bash
#SBATCH --mail-user=tyler.j.hansen@vanderbilt.edu
#SBATCH --mail-type=ALL
#SBATCH--nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --time=03:00:00
#SBATCH --mem=16G
#######################################################                                           
# Tyler Hansen - 2021-02-08 #
# This script will calculate the FRiP score for an ATAC-seq dataset. 
# The output are counts for reads in peaks and total reads for each sample. FRiP score is ("reads in peaks"/"total reads"). 
# FRiP > 0.3 is optimal and FRiP > 0.2 acceptable by ENCODE standards.
#######################################################

module restore tools

BAM='/data/hodges_lab/ATAC-STARR_V2/data/bams/pos-sorted'
OUT_FILE='/data/hodges_lab/ATAC-STARR_V2/results/activity/FRiP_scores_compare-PeakCalls.txt'

for PEAK in /data/hodges_lab/ATAC-STARR_V2/data/z-archive/STARRPeaker_results/GM12878inGM12878_+cov_0.1pval_+duplicates.peak.final.bed \
/data/hodges_lab/ATAC-STARR_V2/data/z-archive/CRADLE/CRADLE_corrected_within_OCRs/GM12878inGM12878_Peaks/GM12878inGM12878_active_CRADLE_peaks.bed \
/data/hodges_lab/ATAC-STARR_V2/data/z-archive/macs2_peaks/callpeak/GM12878inGM12878_callpeak_peaks.broadPeak \
/data/hodges_lab/ATAC-STARR_V2/data/activity/individual/DESeq2_results/fragmentGroups-method/ATAC-STARR_REs/active/GM12878inGM12878_active-REs_0.1padj.bed \
/data/hodges_lab/ATAC-STARR_V2/data/activity/individual/DESeq2_results/bin-method/GM12878inGM12878_active_0.1padj_50-bin.merged.bed
do 
    echo $PEAK >> $OUT_FILE
    echo "DNA Reads in Peaks" >> $OUT_FILE
    samtools view -L $PEAK ${BAM}/GM12878inGM12878_DNA_merged.filtered.pos-sorted.bam | wc -l >> $OUT_FILE
    echo "Total DNA Reads" >> $OUT_FILE
    samtools view ${BAM}/GM12878inGM12878_DNA_merged.filtered.pos-sorted.bam | wc -l >> $OUT_FILE
    echo "RNA Reads in Peaks" >> $OUT_FILE
    samtools view -L $PEAK ${BAM}/GM12878inGM12878_RNA_merged.filtered.pos-sorted.bam | wc -l >> $OUT_FILE
    echo "Total RNA Reads" >> $OUT_FILE
    samtools view ${BAM}/GM12878inGM12878_RNA_merged.filtered.pos-sorted.bam | wc -l >> $OUT_FILE
done