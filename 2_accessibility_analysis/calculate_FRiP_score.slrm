#!/bin/bash
#SBATCH --mail-user=tyler.j.hansen@vanderbilt.edu
#SBATCH --mail-type=ALL
#SBATCH--nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --time=01:00:00
#SBATCH --mem=16G
#######################################################                                           
# Tyler Hansen - 2021-02-08 #
# This script will calculate the FRiP score for an ATAC-seq dataset. 
# The output are counts for reads in peaks and total reads for each sample. FRiP score is ("reads in peaks"/"total reads"). 
# FRiP > 0.3 is optimal and FRiP > 0.2 acceptable by ENCODE standards.
#######################################################

module restore tools

BAM='/data/hodges_lab/public_data/GM12878/obtained_as_raw_files/ATAC_GM12878_2013-buenrostro/data/bams/pos-sorted/GM12878_ATAC-seq_buenrostro_merged.unique.pos-sorted.bam'
PEAK='/data/hodges_lab/public_data/GM12878/obtained_as_raw_files/ATAC_GM12878_2013-buenrostro/data/genrich_peaks/GM12878_ATAC-seq_buenrostro_genrich_0.0001-qvalue.narrowPeak'
OUT_FILE='/data/hodges_lab/ATAC-STARR_V2/results/accessibility/Correlation/FRiP_scores.txt'

echo "Buenrostro ATAC-seq" > $OUT_FILE
echo "Reads in Peaks" >> $OUT_FILE
samtools view -L $PEAK $BAM | wc -l >> $OUT_FILE
echo "Total Reads" >> $OUT_FILE
samtools view $BAM | wc -l >> $OUT_FILE

BAM='/data/hodges_lab/ATAC-STARR_V2/data/bams/pos-sorted/GM12878inGM12878_DNA_merged.unique.pos-sorted.bam'
PEAK='/data/hodges_lab/ATAC-STARR_V2/data/accessibility/genrich_ATAC-like_peaks/GM12878inGM12878_DNA_genrich_0.0001-qvalue.narrowPeak'
echo "GM12878 ATAC-STARR" >> $OUT_FILE
echo "Reads in Peaks" >> $OUT_FILE
samtools view -L $PEAK $BAM | wc -l >> $OUT_FILE
echo "Total Reads" >> $OUT_FILE
samtools view $BAM | wc -l >> $OUT_FILE
