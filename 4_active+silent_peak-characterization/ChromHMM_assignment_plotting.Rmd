---
title: "ChromHMM Assignment"
author: "Tyler Hansen"
date: "5/4/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, Libraries, warning=FALSE, message=FALSE}
library(tidyverse)
library(extrafont)
loadfonts(device = "win")
library(ggrepel)
library(pals)
library(RColorBrewer)
```
```{r Bar Chart}
#Read_tsvs
active <- read_tsv(file = "C:/Users/tyler/Dropbox (VU Basic Sciences)/Hodges Lab/Results and Data/Bioinformatics/ATAC-STARR_analysis/3_Accre_Local/ATAC-STARR/results/activity/ChromHMM_assignment/GM12878inGM12878_active_0.1padj_50-bin_ChromHMM.bed", col_names = c("Chr", "Start", "End", "Chrom_HMM_State")) %>% mutate(Type="Active Peaks")
silent <- read_tsv(file = "C:/Users/tyler/Dropbox (VU Basic Sciences)/Hodges Lab/Results and Data/Bioinformatics/ATAC-STARR_analysis/3_Accre_Local/ATAC-STARR/results/activity/ChromHMM_assignment/GM12878inGM12878_silent_0.1padj_50-bin_ChromHMM.bed", col_names = c("Chr", "Start", "End", "Chrom_HMM_State")) %>% mutate(Type="Silent Peaks")
OCRs <- read_tsv(file = "C:/Users/tyler/Dropbox (VU Basic Sciences)/Hodges Lab/Results and Data/Bioinformatics/ATAC-STARR_analysis/3_Accre_Local/ATAC-STARR/results/activity/ChromHMM_assignment/GM12878inGM12878_DNA_genrich_0.0001-qvalue_ChromHMM.bed", col_names = c("Chr", "Start", "End", "Chrom_HMM_State")) %>% mutate(Type="Open Chromatin Regions")

tsv <- bind_rows(active, silent, OCRs)
tsv$Type <- factor(tsv$Type, levels = c("Silent Peaks", "Active Peaks", "Open Chromatin Regions"))

tsv_tally <- group_by(tsv, Chrom_HMM_State, Type) %>% tally()

tsv_tally$Chrom_HMM_State <- factor(tsv_tally$Chrom_HMM_State, levels = c("1_TssA", "2_TssFlnk", "3_TssFlnkU", "4_TssFlnkD", "5_Tx", "6_TxWk", "7_EnhG1", "8_EnhG2", "9_EnhA1", "10_EnhA2", "11_EnhWk", "12_ZNF/Rpts", "13_Het", "14_TssBiv", "15_EnhBiv", "16_ReprPC", "17_ReprPCWk", "18_Quies"))

nb.cols <- 18
mycolors <- colorRampPalette(brewer.pal(10, "Paired"))(nb.cols)

bar <- ggplot(tsv_tally, aes(y = Type, x = n, fill = Chrom_HMM_State)) + 
  geom_bar(width = 1, stat = "identity", color = "white", size = 0.1, position = "fill") +
  scale_fill_manual(values = mycolors) +
  ggtitle("") +
  labs(fill="ChromHMM State") +
  theme_bw(base_family = "Arial", base_size = 8) +
  theme(legend.position = "bottom", legend.key.size = unit(0.15, "inches"), plot.title = element_text(hjust = 0.5, face = "bold", size = 12), axis.title = element_blank()) 

ggsave(bar, filename = "C:/Users/tyler/Dropbox (VU Basic Sciences)/Hodges Lab/Results and Data/Bioinformatics/ATAC-STARR_analysis/3_Accre_Local/ATAC-STARR/results/activity/ChromHMM_assignment/barchart.pdf", device = cairo_pdf, width=4, height=3)
```
